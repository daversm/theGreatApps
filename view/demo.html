<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sign up</title>
    <link rel="stylesheet" href="../public/css/base.css"  />
    <script src="../public/tracks.js"></script>
    <script src="../public/Recorderjs/recorder.js"></script>
    <script src="../public/wavesurfer.min.js"></script>
    <script src="../public/wavesurfer.microphone.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900,100italic,300italic,400italic,500italic' rel='stylesheet' type='text/css'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
    <style>
      body{
        background-image: url("../public/css/c4.jpg");
        background-position: center;
        background-size: cover;
      }

    </style>
  </head>
  <body id="demoPage">

    <div id="naviBar">
        <a href="/"><h6>Home </h6></a>
        <a href="/"><h6>About </h6></a>
        <a href="/signup"><h6>Register </h6></a>
        <a href="/passwordReset"><h6>Forgot Password</h6></a>
    </div>

    <div class="logo"><h5>TGA</h6></div>
    <div id="masterPanel"></div>
    <div id="tracksDiv"></div>

      <script>
        var navigator = window.navigator;
        navigator.getUserMedia = ( navigator.getUserMedia ||
                         navigator.webkitGetUserMedia ||
                         navigator.mozGetUserMedia ||
                         navigator.msGetUserMedia);
        var mediaStream;

      </script>

      <script type="text/babel">


          var MasterController = React.createClass({
            getInitialState: function() {
              return {micSwitchState: false};
            },
            handleMasterPlay: function(){
              console.log(mediaStream);
            },
            handleMicSwitchChange: function(e) {
              console.log(e.target.checked);
              var outerThis = this;
              if(e.target.checked == true){
                navigator.getUserMedia({audio: true}, function(localMediaStream){
                  mediaStream = localMediaStream;

                }, function(err){
                  console.log('Browser not supported');
                });
              }else{
                mediaStream.getTracks()[0].stop();
              }

            },

            render: function() {

              return (
                <div className="masterControllPanel" >
                  <p>MASTER CONTROLLER</p>
                  <div className="onoffswitch">
                      <input
                            type="checkbox" name="onoffswitch" className="onoffswitch-checkbox"
                            id="myonoffswitch" onChange={this.handleMicSwitchChange} checked={this.micSwitchState}
                      />
                      <label className="onoffswitch-label" htmlFor="myonoffswitch">
                          <span className="onoffswitch-inner"></span>
                          <span className="onoffswitch-switch"></span>
                      </label>
                  </div>
                  <div id="play" onClick={this.handleMasterPlay}></div>
                  <div id="pause"></div>
                  <div id="stop"></div>
                  <div id="rec"></div>
                </div>
              );
            }
          });

          var TracksPanel = React.createClass({
            render: function(){
              return(
                <div>
                  <Tracks />
                </div>
              );
            }
          });

          var Tracks = React.createClass({
            componentDidMount: function(){
              this.wavesurfer = Object.create(WaveSurfer);
              this.wavesurfer.init({
                container     : '#trackOne',
                waveColor     : 'black',
                interact      : false,
                cursorWidth   : 0
              });
              this.microphone = Object.create(WaveSurfer.Microphone);
              this.microphone.init({
                  wavesurfer: this.wavesurfer
              });

            },
            handleLiveFeed: function(){
              this.microphone.gotStream(mediaStream);
            },
            handleDownloadTrack: function(){
              this.microphone.gotStream(mediaStream);
            },
            handlePause: function(){
              this.microphone.gotStream(mediaStream);
            },
            handlePlay: function(){
              this.microphone.gotStream(mediaStream);
            },

            render: function(){
              return (
                  <div className="containerTrackDiv">

                    <div className="playbackRecordingDiv">

                      <div className="playbackOptionsDiv">
                        <div onClick={this.handleLiveFeed}>PLAY</div>
                        <div onClick={this.handleLiveFeed}>STOP</div>
                      </div>
                      <div className="recordingOptionsDiv">
                        <div onClick={this.handleLiveFeed}>LIVE</div>
                        <div onClick={this.handleLiveFeed}>RECORD</div>
                      </div>

                    </div>

                    <div id="trackOne" className="waveformContainerDiv"></div>

                  </div>
              );
            }
          });

          ReactDOM.render(
          <MasterController />,
          document.getElementById('masterPanel')
          );

          ReactDOM.render(
          <TracksPanel />,
          document.getElementById('tracksDiv')
          );

      </script>



  </body>
</html>
