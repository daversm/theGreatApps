<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sign up</title>
    <!-- Not present in the tutorial. Just for basic styling. -->
    <link rel="stylesheet" href="../public/css/base.css"  />
    <script src="../public/tracks.js"></script>
    <script src="../public/Recorderjs/recorder.js"></script>
    <script src="../public/wavesurfer.min.js"></script>
    <script src="../public/wavesurfer.microphone.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900,100italic,300italic,400italic,500italic' rel='stylesheet' type='text/css'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
  </head>
  <body>
    <div class="logo"><h5>TGA</h6></div>
    <div id="masterPanel"></div>
    <div id="tracksDiv"></div>
    <div id="tracksTesting">
      <button onclick=record()>record</button>
    </div>


    </div>
      <script>
      /*
      var wavesurfer = Object.create(WaveSurfer);

      wavesurfer.init({
        container     : '#tracksTesting',
        waveColor     : 'black',
        interact      : false,
        cursorWidth   : 0
      });

      var microphone = Object.create(WaveSurfer.Microphone);

      microphone.init({
          wavesurfer: wavesurfer
      });

      var navigator = window.navigator;
      navigator.getUserMedia = ( navigator.getUserMedia ||
                             navigator.webkitGetUserMedia ||
                             navigator.mozGetUserMedia ||
                             navigator.msGetUserMedia);

      var Context = window.AudioContext || window.webkitAudioContext;
      var context = new Context();
      var mediaStream;

  navigator.getUserMedia({audio: true}, function(localMediaStream){
    mediaStream = localMediaStream;

    microphone.gotStream(localMediaStream);

  }, function(err){
    console.log('Browser not supported');
  });
  */

  var wavesurfer = Object.create(WaveSurfer);

  wavesurfer.init({
    container     : '#tracksTesting',
    waveColor     : 'black',
    interact      : false,
    cursorWidth   : 0
  });

  var microphone = Object.create(WaveSurfer.Microphone);

  microphone.init({
      wavesurfer: wavesurfer
  });


  var navigator = window.navigator;
  navigator.getUserMedia = ( navigator.getUserMedia ||
                         navigator.webkitGetUserMedia ||
                         navigator.mozGetUserMedia ||
                         navigator.msGetUserMedia);
  var Context = window.AudioContext || window.webkitAudioContext;
  var context = new Context();

  var rec;
  var mediaStream;

  //var mediaStream;




      </script>


      <script type="text/babel">
          

          var MasterController = React.createClass({
            getInitialState: function() {
              return {micSwitchState: false};
            },
            handleMasterPlay: function(){
              console.log(mediaStream);
              microphone.gotStream(mediaStream);
            },
            handleMicSwitchChange: function(e) {
              console.log(e.target.checked);
              var outerThis = this;
              if(e.target.checked == true){
                navigator.getUserMedia({audio: true}, function(localMediaStream){
                  mediaStream = localMediaStream;

                }, function(err){
                  console.log('Browser not supported');
                });
              }else{
                mediaStream.getTracks()[0].stop();
              }

            },

            render: function() {

              return (
                <div className="masterControllPanel" >
                  <p>MASTER CONTROLLER</p>
                  <div className="onoffswitch">
                      <input
                            type="checkbox" name="onoffswitch" className="onoffswitch-checkbox"
                            id="myonoffswitch" onChange={this.handleMicSwitchChange} checked={this.micSwitchState}
                      />
                      <label className="onoffswitch-label" htmlFor="myonoffswitch">
                          <span className="onoffswitch-inner"></span>
                          <span className="onoffswitch-switch"></span>
                      </label>
                  </div>
                  <div id="play" onClick={this.handleMasterPlay}></div>
                  <div id="pause"></div>
                  <div id="stop"></div>
                  <div id="rec"></div>
                </div>
              );
            }
          });

          ReactDOM.render(
          <MasterController />,
          document.getElementById('masterPanel')
          );

/*
          var TracksPanel = React.createClass({
            render: function(){
              return(
                <div>
                  <Tracks />
                </div>
              );
            }
          });

          var Tracks = React.createClass({
            componentDidMount: function(){
              this.trackOne = new Track(mediaStream);

            },
            handleRecord: function(){
              //this.trackOne.record();
              console.log(mediaStream);
            },
            render: function(){

              return (
                  <div>
                  <div id="trackOne"></div>
                    {this.trackOne}
                    <div>
                      <button onClick={this.handleRecord}>record</button>
                    </div>
                  </div>
              );
            }
          });

          ReactDOM.render(
          <MasterController />,
          document.getElementById('masterPanel')
          );

          ReactDOM.render(
          <TracksPanel />,
          document.getElementById('tracksDiv')
          );




*/
      </script>



  </body>
</html>
